<div>
    <div class="">
        <div ng-show="newMsg" class="">
            <h4>Start Conversation</h4>

            <fieldset>
                <div class="row">
                    <div class="col-xs-6">
                        <div class="form-group">
                            <label>To:</label>
                            <select ng-model="sendTo" multiple="multiple">
                                <option ng-repeat="username in users" value="{{ username }}">{{ username }}</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Subject:</label>
                            <input type="text" ng-model="subject" />
                        </div>

                        <div class="form-group">
                            <label>Message:</label>
                            <textarea ng-model="text.new"></textarea>
                        </div>

                        <button ng-click="startConversation()">Send</button>
                    </div>
                </div>


            </fieldset>

        </div>
        <div style="clear: both" ng-repeat="(messageID, message) in user.messages.unseen track by $index">
            <div class="col-xs-12" style="padding:0;margin:0;height: inherit;overflow-y: scroll">
                <button style="width: 100%" class="btn btn-small" ng-click="msgChecked=!msgChecked" ng-hide="msgChecked">
                    <span><b>{{ message.subject }}</b></span>  <span ng-repeat="(user,boo) in message.users">{{ user }} </span></button>
                <button style="width: 100%" class="btn btn-small" ng-click="msgChecked=!msgChecked" ng-show="msgChecked">Hide Conversation</button>
            </div>
            <div class="col-xs-12">
                <div ng-show="msgChecked">
                    <div  ng-init="{timestamp:null}" style="max-height: 200px; overflow-y: scroll">
                        <div class="col-xs-12" ng-repeat="(timestamp, contrib) in message.conversation" >
                            <p class="col-xs-12 text-center">
                                {{ timestamp | date:'shortDate'  }} - {{ timestamp | date:'shortTime'  }}
                            </p>
                            <span class="well"><code>{{ contrib.user }}:</code> <b>{{ contrib.text }}</b></span><hr>
                        </div>
                    </div>
                    <h4 id="msgHeader">Add Message:</h4>
                    <div class="form-group col-xs-10">
                        <textarea ng-model="text[$index]"></textarea>
                    </div>

                    <button class="col-xs-2" ng-show="text[$index]" ng-click="sendMessage(messageID, $index)">Send</button>
                </div>
            </div>

        </div>

    </div>



</div>
