<div>
    <div ng-if="product|| $parent.product">{{product}}</div>
    <div ng-if="!product && !$parent.product">
        <div class="col-xs-12 category">
        <h4>Sub-Categories</h4>
        <ul ng-repeat="(childPrio,child) in (shop.category.children || $parent.shop.category.children) | orderByPriority | isCategory">
            <li ng-mouseover="catalogDrop=true" ng-mouseleave="catalogDrop=false">
                <a eco-ref="shop.pathStr+'/'+(child.url?child.url:child.$id)" >{{child.name}}</a> /

                <div ng-show="catalogDrop">
                    <ul>
                        <li ng-repeat="subChild in child.children | orderByPriority | isCategory">
                            <a eco-ref="shop.pathStr+'/'+(child.url?child.url:child.$id)+'/'+(subChild.url?subChild.url:subChild.$id)">{{subChild.name}}</a>
                        </li>
                    </ul>
                    <ul>
                        <li ng-repeat="subChild in child.children | orderByPriority | isProduct">
                            <a eco-ref="shop.pathStr+'/'+(child.url?child.url:child.$id)+'/'+(subChild.url?subChild.url:subChild.$id)">{{subChild.name}}</a>
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
    </div>
    <div class="col-xs-3">Filters</div>
    <div class="col-xs-3"><h3>{{shop.category.name}}</h3>
        <h4>Products</h4>
        <ul>
            <li ng-repeat="(childPrio,child) in shop.category.children | orderByPriority | isProduct">
                <a eco-ref="shop.pathStr+'/'+(child.url?child.url:child.$id)">
                    <span ng-if="!inventory[child.$id]">{{child.name}}</span>
                    <span ng-if="inventory[child.$id]">{{inventory[child.$id].brand}} {{inventory[child.$id].name}} {{inventory[child.$id].size}}</span>
                </a>
            </li>
        </ul></div>
        <div class="col-xs-6">
            <div ng-show="shop.product">
                <h3>{{shop.product.name}}</h3>
                <div>
                    <div class="price">{{shop.product.price | currency}}</div>
                    <div class="stock"><strong>{{shop.product.stock}}</strong> in stock</div>
                </div>
                <div>
                    <input type="number" ng-model="qty" />
                    <button ng-click="addProduct(shop.product, qty)">Add to Cart</button>
                </div>

                {{shop.product.$id}}

            </div>
            <div ng-show="shop.productURI && !shop.product">
                <p>Could not find requested product '{{shop.productURI}}'</p>
                <p>Return to category <a eco-ref="shop.pathStr"><span ng-show="shop.category">{{shop.category.name}}</span><span ng-hide="shop.category">parent</span></a>.</p>
            </div>
        </div>

    <div ng-hide="shop">
        Shop is not initialized.
    </div>
        <ul ng-repeat="thing in shop.product" style="overflow-x:hidden;">
            <li>
                {{thing}}
            </li>
        </ul>
</div>
</div>