<div>

    <div class="col-xs-12">
        <div class="col-xs-12" ng-show="newMsg">
            <fieldset>
                <div class="row">
                    <div class="col-xs-6">
                        <div class="form-group">
                            <label>To:</label>
                            <select ng-model="sendTo" multiple="multiple">
                                <option ng-repeat="username in users" value="{{ username }}">{{ username }}</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Subject:</label>
                            <input type="text" ng-model="subject" />
                        </div>

                        <div class="form-group">
                            <label>Message:</label>
                            <textarea ng-model="text.new"></textarea>
                        </div>

                        <button ng-click="startConversation()">Send</button>
                    </div>
                </div>


            </fieldset>

        </div>

        <div  style="clear: both" ng-repeat="(messageID, message) in user.messages.unseen track by $index">
            <p ng-show="msgChecked">messageID: {{ messageID }}</p>
            <button ng-click="msgChecked=!msgChecked" ng-hide="msgChecked">{{ message.subject }}</button>
            <button ng-click="msgChecked=!msgChecked" ng-show="msgChecked">Hide Conversation</button>
            <span ng-repeat="(user,boo) in message.users">{{ user }} </span>

            <div class="col-xs-12">
                <div ng-show="msgChecked">
                    <div style="max-height: 300px; overflow-y: scroll">
                        <div class="col-xs-12" ng-repeat="(timestamp, contrib) in message.conversation" >
                             <code class="col-xs-3">{{ timestamp | date:'shortDate'  }} {{ timestamp | date:'shortTime'  }}</code> <span class="col-xs-9"><b>{{ contrib.user }}:</b> {{ contrib.text }}</span><hr>
                        </div>

                        <h4 id="msgHeader">Add Message:</h4>
                        <div class="form-group col-xs-10">
                            <textarea ng-model="text[$index]"></textarea>
                        </div>

                        <button class="col-xs-2" ng-show="text[$index]" ng-click="sendMessage(messageID, $index)">Send</button>
                    </div>
                </div>
            </div>
        </div>

    </div>



</div>
